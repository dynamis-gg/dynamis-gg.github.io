resource discord_text_channel {{ chanslug }} {
  name = "{{ channel.name | safe}}"
  topic = "{{ channel.topic | default(value="") | safe }}"
  nsfw = {{ page.extra.nsfw | default(value=false) }}

  server_id = local.server_id
  category = resource.discord_category_channel.{{ catslug }}.id
  position = {{ chan_index }}
  sync_perms_with_category = false

  lifecycle {
    ignore_changes = [sync_perms_with_category]
  }
}

{% for msg in channel.messages | default(value=[]) %}
  resource discord_message {{ chanslug }}_{{ loop.index }} {
    channel_id = resource.discord_text_channel.{{ chanslug }}.id
    embed {
      description = <<HERE
        {{ msg.description | safe }}
      HERE {# >> #}
      title = "{{ msg.title | safe }}"
    }
    {% if loop.index == 1 %}
      pinned = true
    {% else %}
      depends_on = [resource.discord_message.{{ chanslug }}_{{ loop.index }}]
    {% endif %}
  }
{% endfor %}
